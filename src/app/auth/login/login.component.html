<div class="login-container">
  <h2>Iniciar sesión</h2>

  <!-- Mensaje de error general del backend -->
  <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

  <!-- Formulario de email y contraseña (oculto después de enviar el OTP) -->
  <form *ngIf="!otpSent" (ngSubmit)="onSubmit()" [formGroup]="loginForm" novalidate>
    <div>
      <label for="email">Email</label>
      <input id="email" type="email" formControlName="email" />
      <div *ngIf="loginForm.get('email')?.touched && loginForm.get('email')?.invalid" class="error">
        <small *ngIf="loginForm.get('email')?.errors?.['required']">El email es obligatorio.</small>
        <small *ngIf="loginForm.get('email')?.errors?.['email']">Email inválido.</small>
      </div>
    </div>

    <div class="password-container">
      <label for="password">Contraseña</label>
      <input id="password" [type]="passwordType" formControlName="password" />
      <span class="password-toggle" (click)="togglePasswordVisibility()">
        <svg *ngIf="passwordType === 'password'" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye-off"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 1.73A10.66 10.66 0 0 1 12 2c4.7 0 8.72 2.06 10 5.5a17.79 17.79 0 0 1-3.22 4.19l-1.41-1.41"/><path d="M2 12s3-7 10-7c.76 0 1.5.11 2.22.33"/><path d="M22 22 2 2"/><path d="M16.27 16.27a6 6 0 0 1-8.54-8.54"/></svg>
        <svg *ngIf="passwordType === 'text'" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
      </span>
      <div *ngIf="loginForm.get('password')?.touched && loginForm.get('password')?.invalid" class="error">
        <small *ngIf="loginForm.get('password')?.errors?.['required']">La contraseña es obligatoria.</small>
        <small *ngIf="loginForm.get('password')?.errors?.['minlength']">Mínimo 6 caracteres.</small>
      </div>
    </div>

    <button type="submit" [disabled]="loginForm.invalid">Entrar</button>
  </form>

  <!-- Formulario para el código OTP (visible después del primer envío) -->
  <form *ngIf="otpSent" (ngSubmit)="onSubmit()" [formGroup]="otpForm" novalidate>
    <div>
      <p>Se ha enviado un código de 6 dígitos a **{{ emailForOtp }}**.</p>
      <label for="otpCode">Código OTP</label>
      <input id="otpCode" type="text" formControlName="otpCode" />
      <div *ngIf="otpForm.get('otpCode')?.touched && otpForm.get('otpCode')?.invalid" class="error">
        <small *ngIf="otpForm.get('otpCode')?.errors?.['required']">El código es obligatorio.</small>
        <small *ngIf="otpForm.get('otpCode')?.errors?.['minlength'] || otpForm.get('otpCode')?.errors?.['maxlength']">El código debe tener 6 dígitos.</small>
      </div>
    </div>
    <button type="submit" [disabled]="otpForm.invalid">Verificar</button>
  </form>

  <div class="login-link" style="margin-top: 10px;">
    ¿No tienes una cuenta? <a (click)="navigateToRegister()" style="cursor: pointer;">Regístrate</a>
  </div>
</div>
