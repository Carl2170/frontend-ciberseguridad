<div class="dashboard-container">
  <header class="header">
    <div
      *ngIf="showNewDataBanner"
      class="new-event-banner"
      [ngClass]="{
        'fade-in': showNewDataBanner && !fadingOut,
        'fade-out': fadingOut
      }"
    >
      🔄 Nuevo evento de seguridad detectado. Actualizando vista...
    </div>

    <h1 class="text-3xl font-bold text-white text-shadow">
      Dashboard de Monitoreo
    </h1>
    <button (click)="logout()" class="logout-button">Cerrar Sesión</button>
  </header>

  <main>
    <!-- Indicador de carga -->
    <div *ngIf="isLoading" class="message-box loading-message">
      Cargando datos de monitoreo...
    </div>

    <!-- Mensaje de error -->
    <div *ngIf="errorMessage" class="message-box error-message" role="alert">
      <strong class="font-bold">Error!</strong>
      <span class="block sm:inline"> {{ errorMessage }}</span>
    </div>

    <!-- Contenido principal -->
    <div *ngIf="!isLoading && filteredData.length > 0">
      <h2 class="text-2xl font-bold text-white mb-6 text-shadow">
        Eventos de Seguridad Recientes
      </h2>

      <!-- Filtro por tipo -->
      <div class="mb-4" style="margin-bottom: 10px">
        <label for="eventFilter" class="block mb-2 font-semibold text-white"
          >Filtrar por tipo de evento:</label
        >
        <select
          id="eventFilter"
          [(ngModel)]="selectedEventType"
          (change)="applyFilter()"
          class="w-full md:w-1/3 p-2 rounded text-black"
          style="margin-left: 10px"
        >
          <option value="">Todos</option>
          <option *ngFor="let type of availableEventTypes" [value]="type">
            {{ type }}
          </option>
        </select>

        <div
          *ngIf="selectedEventType"
          class="event-type-description text-gray-300 mt-2 mb-4 p-3 rounded bg-white/10"
        >
          {{
            eventTypeDescriptions[selectedEventType] ||
              "Descripción no disponible para este tipo."
          }}
        </div>
      </div>

      <!-- Tarjetas de eventos -->
      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        <div class="event-card" *ngFor="let event of filteredData">
          <h3 class="text-xl font-semibold mb-2 text-blue-300 break-words">
            {{ event.event_type | uppercase }}
          </h3>
          <ul class="space-y-2 text-gray-200 text-sm">
            <li><strong>ID:</strong> {{ event.id }}</li>
            <li><strong>Dirección IP:</strong> {{ event.ip_address }}</li>
            <li><strong>Agente de Usuario:</strong> {{ event.user_agent }}</li>
            <li><strong>Ruta:</strong> {{ event.path }}</li>
            <li>
              <strong>Carga útil (Payload):</strong>
              <pre class="payload-box">{{ event.payload }}</pre>
            </li>
            <li>
              <strong>¿Bloqueado?:</strong>
              <span
                [ngClass]="{
                  'text-green-400': !event.is_blocked,
                  'text-red-400': event.is_blocked
                }"
              >
                {{ event.is_blocked ? "Sí" : "No" }}
              </span>
            </li>
            <li>
              <strong>Fecha de Creación:</strong>
              {{ getBoliviaTime(event.created_at) }}
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Mensaje si no hay datos disponibles -->
    <div
      *ngIf="!isLoading && filteredData.length === 0"
      class="message-box no-data-message"
    >
      No hay eventos de seguridad para mostrar.
    </div>
  </main>
</div>
